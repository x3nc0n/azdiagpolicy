{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "variables": {
        "scope": "/providers/Microsoft.Management/managementGroups/SF/SF-decommissioned",
        "policies": {
            "policyDefinitions": [
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Container Instances to stream to a Log Analytics workspace when any ACR which is missing this diagnostic settings is created or updated. The Policy willset the diagnostic with all metrics enabled.",
                        "displayName": "Deploy Diagnostic Settings for Container Instances to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.ContainerInstance/containerGroups"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.ContainerInstance/containerGroups/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-ACI"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Container Registry to stream to a Log Analytics workspace when any ACR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics  enabled.",
                        "displayName": "Deploy Diagnostic Settings for Container Registry to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.ContainerRegistry/registries"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.ContainerRegistry/registries/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "ContainerRegistryLoginEvents",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "ContainerRegistryRepositoryEvents",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-ACR"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Analysis Services to stream to a Log Analytics workspace when any Analysis Services which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Analysis Services to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.AnalysisServices/servers"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.AnalysisServices/servers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Engine",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Service",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-AnalysisService"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for API Management to stream to a Log Analytics workspace when any API Management which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for API Management to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.ApiManagement/service"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.ApiManagement/service/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "GatewayLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-APIMgmt"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Application Gateway to stream to a Log Analytics workspace when any Application Gateway which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Application Gateway to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/applicationGateways"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/applicationGateways/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "ApplicationGatewayAccessLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "ApplicationGatewayPerformanceLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "ApplicationGatewayFirewallLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-ApplicationGateway"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for App Service Plan to stream to a Log Analytics workspace when any App Service Plan which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for App Service Plan to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Web/serverfarms"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Web/serverfarms/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-WebServerFarm"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Web App to stream to a Log Analytics workspace when any Web App which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for App Service to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "allOf": [
                                    {
                                        "field": "type",
                                        "equals": "Microsoft.Web/sites"
                                    },
                                    {
                                        "value": "[[field('kind')]",
                                        "notContains": "functionapp"
                                    }
                                ]
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Web/sites/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "AppServiceAntivirusScanAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceHTTPLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceConsoleLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceHTTPLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceAppLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceFileAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServiceIPSecAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AppServicePlatformLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-Website"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Automation to stream to a Log Analytics workspace when any Automation which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Automation to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Automation/automationAccounts"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Automation/automationAccounts/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "timeGrain": null,
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "JobLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "JobStreams",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DscNodeStatus",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-AA"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for CDN Endpoint to stream to a Log Analytics workspace when any CDN Endpoint which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for CDN Endpoint to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Cdn/profiles/endpoints"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Cdn/profiles/endpoints/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [],
                                                            "logs": [
                                                                {
                                                                    "category": "CoreAnalytics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('fullName')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-CDNEndpoints"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Cognitive Services to stream to a Log Analytics workspace when any Cognitive Services which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Cognitive Services to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.CognitiveServices/accounts"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.CognitiveServices/accounts/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Audit",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "RequestResponse",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Trace",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-CognitiveServices"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Cosmos DB to stream to a Log Analytics workspace when any Cosmos DB which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Cosmos DB to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DocumentDB/databaseAccounts"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DocumentDB/databaseAccounts/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "Requests",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "DataPlaneRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "MongoRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "QueryRuntimeStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "PartitionKeyStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "PartitionKeyRUConsumption",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "ControlPlaneRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "CassandraRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "GremlinRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-CosmosDB"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Databricks to stream to a Log Analytics workspace when any Databricks which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Databricks to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Databricks/workspaces"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Databricks/workspaces/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "logs": [
                                                                {
                                                                    "category": "dbfs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "clusters",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "accounts",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "jobs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "notebook",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "ssh",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "workspace",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "secrets",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "sqlPermissions",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "instancePools",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-Databricks"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Data Factory to stream to a Log Analytics workspace when any Data Factory which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Data Factory to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DataFactory/factories"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DataFactory/factories/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "ActivityRuns",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "PipelineRuns",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "TriggerRuns",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISPackageEventMessages",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISPackageExecutableStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISPackageEventMessageContext",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISPackageExecutionComponentPhases",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISPackageExecutionDataStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SSISIntegrationRuntimeLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-DataFactory"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Data Lake Analytics to stream to a Log Analytics workspace when any Data Lake Analytics which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Data Lake Analytics to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DataLakeAnalytics/accounts"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Audit",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Requests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-DLAnalytics"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Event Grid subscriptions to stream to a Log Analytics workspace when any Event Grid subscriptions which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Event Grid subscriptions to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.EventGrid/eventSubscriptions"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.EventGrid/eventSubscriptions/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-EventGridSub"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Event Grid Topic to stream to a Log Analytics workspace when any Event Grid Topic which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Event Grid Topic to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.EventGrid/topics"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.EventGrid/topics/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "DeliveryFailures",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "PublishFailures",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-EventGridTopic"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Event Grid System Topic to stream to a Log Analytics workspace when any Event Grid System Topic which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Event Grid System Topic to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.EventGrid/systemTopics"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.EventGrid/systemTopics/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "DeliveryFailures",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-EventGridSystemTopic"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for ExpressRoute to stream to a Log Analytics workspace when any ExpressRoute which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for ExpressRoute to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/expressRouteCircuits"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/expressRouteCircuits/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "PeeringRouteLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-ExpressRoute"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Firewall to stream to a Log Analytics workspace when any Firewall which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Firewall to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/azureFirewalls"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/azureFirewalls/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "AzureFirewallApplicationRule",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AzureFirewallNetworkRule",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AzureFirewallDnsProxy",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-Firewall"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Front Door to stream to a Log Analytics workspace when any Front Door which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Front Door to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/frontDoors"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/frontDoors/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "FrontdoorAccessLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "FrontdoorWebApplicationFirewallLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-FrontDoor"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Azure Function App to stream to a Log Analytics workspace when any function app which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Azure Function App to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "allOf": [
                                    {
                                        "field": "type",
                                        "equals": "Microsoft.Web/sites"
                                    },
                                    {
                                        "value": "[[field('kind')]",
                                        "contains": "functionapp"
                                    }
                                ]
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Web/sites/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "FunctionAppLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-Function"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for HDInsight to stream to a Log Analytics workspace when any HDInsight which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for HDInsight to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.HDInsight/clusters"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.HDInsight/clusters/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-HDInsight"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for IoT Hub to stream to a Log Analytics workspace when any IoT Hub which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for IoT Hub to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Devices/IotHubs"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Devices/IotHubs/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Connections",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DeviceTelemetry",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "C2DCommands",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DeviceIdentityOperations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "FileUploadOperations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Routes",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "D2CTwinOperations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "C2DTwinOperations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "TwinQueries",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "JobsOperations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DirectMethods",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DistributedTracing",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Configurations",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DeviceStreams",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-iotHub"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Load Balancer to stream to a Log Analytics workspace when any Load Balancer which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Load Balancer to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/loadBalancers"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/loadBalancers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "timeGrain": null,
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "LoadBalancerAlertEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "LoadBalancerProbeHealthStatus",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-LoadBalancer"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Logic Apps integration service environment to stream to a Log Analytics workspace when any Logic Apps integration service environment which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Logic Apps integration service environment to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Logic/integrationAccounts"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Logic/integrationAccounts/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [],
                                                            "logs": [
                                                                {
                                                                    "category": "IntegrationAccountTrackingEvents",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-LogicAppsISE"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for MariaDB to stream to a Log Analytics workspace when any MariaDB  which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for MariaDB to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforMariaDB/servers"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DBforMariaDB/servers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "MySqlSlowLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "MySqlAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-MariaDB"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Machine Learning workspace to stream to a Log Analytics workspace when any Machine Learning workspace which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Machine Learning workspace to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.MachineLearningServices/workspaces"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.MachineLearningServices/workspaces/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "Run",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                },
                                                                {
                                                                    "category": "Model",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": true
                                                                    }
                                                                },
                                                                {
                                                                    "category": "Quota",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                },
                                                                {
                                                                    "category": "Resource",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "AmlComputeClusterEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AmlComputeClusterNodeEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AmlComputeJobEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AmlComputeCpuGpuUtilization",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AmlRunStatusChangedEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-MlWorkspace"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Database for MySQL to stream to a Log Analytics workspace when any Database for MySQL which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Database for MySQL to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforMySQL/servers"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DBforMySQL/servers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "MySqlSlowLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "MySqlAuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-MySQL"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Network Interfaces to stream to a Log Analytics workspace when any Network Interfaces which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Network Interfaces to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/networkInterfaces"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/networkInterfaces/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "timeGrain": null,
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-NIC"
                },
                {
                    "properties": {
                        "description": "Deploys NSG flow logs and traffic analytics to Log Analytics with a specfied retention period.",
                        "displayName": "Deploys NSG flow logs and traffic analytics to Log Analytics",
                        "mode": "Indexed",
                        "parameters": {
                            "retention": {
                                "type": "Integer",
                                "metadata": {
                                    "displayName": "Retention"
                                },
                                "defaultValue": 5
                            },
                            "interval": {
                                "type": "Integer",
                                "metadata": {
                                    "displayName": "Traffic Analytics processing interval mins (10/60)"
                                },
                                "defaultValue": 60
                            },
                            "workspace": {
                                "type": "String",
                                "metadata": {
                                    "strongType": "omsWorkspace",
                                    "displayName": "Resource ID of Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID."
                                },
                                "defaultValue": ""
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.1.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "allOf": [
                                    {
                                        "field": "type",
                                        "equals": "Microsoft.Network/networkSecurityGroups"
                                    }
                                ]
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Network/networkWatchers/flowlogs",
                                    "name": "[[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id'))), 'null/null', concat(split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[8], '/', split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[10]))]",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Network/networkWatchers/flowLogs/enabled",
                                                "equals": "true"
                                            }
                                        ]
                                    },
                                    "existenceScope": "resourceGroup",
                                    "roleDefinitionIds": [
                                        "/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7",
                                        "/providers/Microsoft.Authorization/roleDefinitions/81a9662b-bebf-436f-a333-f67b29880f12",
                                        "/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293",
                                        "/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab",
                                        "/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c"
                                    ],
                                    "resourceGroupName": "[[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), 'NetworkWatcherRG', split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[4])]",
                                    "deploymentScope": "subscription",
                                    "deployment": {
                                        "location": "northeurope",
                                        "properties": {
                                            "mode": "Incremental",
                                            "parameters": {
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "networkSecurityGroup": {
                                                    "value": "[[field('id')]"
                                                },
                                                "workspace": {
                                                    "value": "[[parameters('workspace')]"
                                                },
                                                "retention": {
                                                    "value": "[[parameters('retention')]"
                                                },
                                                "interval": {
                                                    "value": "[[parameters('interval')]"
                                                }
                                            },
                                            "template": {
                                                "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "networkSecurityGroup": {
                                                        "type": "String"
                                                    },
                                                    "workspace": {
                                                        "type": "String"
                                                    },
                                                    "retention": {
                                                        "type": "int"
                                                    },
                                                    "interval": {
                                                        "type": "int"
                                                    },
                                                    "time": {
                                                        "type": "String",
                                                        "defaultValue": "[[utcNow()]"
                                                    }
                                                },
                                                "variables": {
                                                    "resourceGroupName": "[[split(parameters('networkSecurityGroup'), '/')[4]]",
                                                    "securityGroupName": "[[split(parameters('networkSecurityGroup'), '/')[8]]",
                                                    "storageAccountName": "[[concat('es', uniqueString(variables('securityGroupName'), parameters('time')))]"
                                                },
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Resources/deployments",
                                                        "apiVersion": "2019-10-01",
                                                        "name": "[[concat(variables('resourceGroupName'), '.', variables('securityGroupName'))]",
                                                        "resourceGroup": "[[variables('resourceGroupName')]",
                                                        "properties": {
                                                            "mode": "Incremental",
                                                            "template": {
                                                                "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                                "contentVersion": "1.0.0.0",
                                                                "resources": [
                                                                    {
                                                                        "type": "Microsoft.Storage/storageAccounts",
                                                                        "apiVersion": "2019-06-01",
                                                                        "name": "[[variables('storageAccountName')]",
                                                                        "location": "[[parameters('location')]",
                                                                        "properties": {},
                                                                        "kind": "StorageV2",
                                                                        "sku": {
                                                                            "name": "Standard_LRS",
                                                                            "tier": "Standard"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    },
                                                    {
                                                        "type": "Microsoft.Resources/deployments",
                                                        "apiVersion": "2019-10-01",
                                                        "name": "[[concat('NetworkWatcherRG', '.', variables('securityGroupName'))]",
                                                        "resourceGroup": "NetworkWatcherRG",
                                                        "properties": {
                                                            "mode": "Incremental",
                                                            "template": {
                                                                "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                                                                "contentVersion": "1.0.0.0",
                                                                "resources": [
                                                                    {
                                                                        "type": "Microsoft.Network/networkWatchers",
                                                                        "apiVersion": "2020-05-01",
                                                                        "name": "[[concat('NetworkWatcher_', toLower(parameters('location')))]",
                                                                        "location": "[[parameters('location')]",
                                                                        "properties": {},
                                                                        "resources": [
                                                                            {
                                                                                "type": "flowLogs",
                                                                                "apiVersion": "2019-11-01",
                                                                                "name": "[[concat(variables('securityGroupName'), '-Network-flowlog')]",
                                                                                "location": "[[parameters('location')]",
                                                                                "properties": {
                                                                                    "enabled": true,
                                                                                    "format": {
                                                                                        "type": "JSON",
                                                                                        "version": 2
                                                                                    },
                                                                                    "retentionPolicy": {
                                                                                        "days": "[[parameters('retention')]",
                                                                                        "enabled": true
                                                                                    },
                                                                                    "flowAnalyticsConfiguration": {
                                                                                        "networkWatcherFlowAnalyticsConfiguration": {
                                                                                            "enabled": true,
                                                                                            "trafficAnalyticsInterval": "[[parameters('interval')]",
                                                                                            "workspaceResourceId": "[[parameters('workspace')]"
                                                                                        }
                                                                                    },
                                                                                    "storageId": "[[concat(subscription().id, '/resourceGroups/', variables('resourceGroupName'), '/providers/Microsoft.Storage/storageAccounts/', variables('storageAccountName'))]",
                                                                                    "targetResourceId": "[[parameters('networkSecurityGroup')]"
                                                                                },
                                                                                "dependsOn": [
                                                                                    "[[concat('NetworkWatcher_', toLower(parameters('location')))]"
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        "dependsOn": [
                                                            "[[concat(variables('resourceGroupName'), '.', variables('securityGroupName'))]"
                                                        ]
                                                    }
                                                ],
                                                "outputs": {}
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Nsg-FlowLogs-to-LA"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Network Security Groups to stream to a Log Analytics workspace when any Network Security Groups which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Network Security Groups to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/networkSecurityGroups"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/networkSecurityGroups/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [],
                                                            "logs": [
                                                                {
                                                                    "category": "NetworkSecurityGroupEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "NetworkSecurityGroupRuleCounter",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-NetworkSecurityGroups"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Database for PostgreSQL to stream to a Log Analytics workspace when any Database for PostgreSQL which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Database for PostgreSQL to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DBforPostgreSQL/servers"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DBforPostgreSQL/servers/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "PostgreSQLLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "QueryStoreRuntimeStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "QueryStoreWaitStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-PostgreSQL"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Power BI Embedded to stream to a Log Analytics workspace when any Power BI Embedded which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Power BI Embedded to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.PowerBIDedicated/capacities"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.PowerBIDedicated/capacities/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Engine",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-PowerBIEmbedded"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Redis Cache to stream to a Log Analytics workspace when any Redis Cache which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Redis Cache to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Cache/redis"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Cache/redis/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-RedisCache"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Relay to stream to a Log Analytics workspace when any Relay which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Relay to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Relay/namespaces"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Relay/namespaces/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "HybridConnectionsEvent",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-Relay"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for SignalR to stream to a Log Analytics workspace when any SignalR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for SignalR to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.SignalRService/SignalR"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.SignalRService/SignalR/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "AllLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-SignalR"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for SQL Elastic Pools to stream to a Log Analytics workspace when any SQL Elastic Pools which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for SQL Elastic Pools to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Sql/servers/elasticPools"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Sql/servers/elasticPools/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('fullName')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-SQLElasticPools"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for SQL Managed Instances to stream to a Log Analytics workspace when any SQL Managed Instances which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for SQL Managed Instances to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Sql/managedInstances"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Sql/managedInstances/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "logs": [
                                                                {
                                                                    "category": "ResourceUsageStats",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "SQLSecurityAuditEvents",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "DevOpsOperationsAudit",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-SQLMI"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Time Series Insights to stream to a Log Analytics workspace when any Time Series Insights which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Time Series Insights to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.TimeSeriesInsights/environments"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.TimeSeriesInsights/environments/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "Ingress",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Management",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-TimeSeriesInsights"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Traffic Manager to stream to a Log Analytics workspace when any Traffic Manager which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Traffic Manager to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/trafficManagerProfiles"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/trafficManagerProfiles/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "ProbeHealthStatusEvents",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-TrafficManager"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Virtual Machines to stream to a Log Analytics workspace when any Virtual Machines which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Virtual Machines to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Compute/virtualMachines"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Compute/virtualMachines/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-VM"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Virtual Network to stream to a Log Analytics workspace when any Virtual Network which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Virtual Network to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/virtualNetworks"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/virtualNetworks/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "VMProtectionAlerts",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-VirtualNetwork"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Virtual Machine Scale Sets  to stream to a Log Analytics workspace when any Virtual Machine Scale Sets  which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Virtual Machine Scale Sets to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Compute/virtualMachineScaleSets"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Compute/virtualMachineScaleSets/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "enabled": false,
                                                                        "days": 0
                                                                    }
                                                                }
                                                            ],
                                                            "logs": []
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-VMSS"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for VPN Gateway to stream to a Log Analytics workspace when any VPN Gateway which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled.",
                        "displayName": "Deploy Diagnostic Settings for VPN Gateway to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Network/virtualNetworkGateways"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Network/virtualNetworkGateways/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "GatewayDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "IKEDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "P2SDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "RouteDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "RouteDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "TunnelDiagnosticLog",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-VNetGW"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for WVD Host Pools to stream to a Log Analytics workspace when any Host Pools which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all and categorys enabled.",
                        "displayName": "Deploy Diagnostic Settings for WVD Host Pools to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DesktopVirtualization/hostpools"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DesktopVirtualization/hostpools/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "logs": [
                                                                {
                                                                    "category": "Checkpoint",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Error",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Management",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Connection",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "HostRegistration",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "AgentHealthStatus",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-WVDHostPools"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for WVD Workspace to stream to a Log Analytics workspace when any Workspace which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all and categorys enabled.",
                        "displayName": "Deploy Diagnostic Settings for WVD Workspace to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DesktopVirtualization/workspaces"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DesktopVirtualization/workspaces/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "logs": [
                                                                {
                                                                    "category": "Checkpoint",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Error",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Management",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Feed",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-WVDWorkspace"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for WVD Application group to stream to a Log Analytics workspace when any application group which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all and categorys enabled.",
                        "displayName": "Deploy Diagnostic Settings for WVD Application group to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.DesktopVirtualization/applicationGroups"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.DesktopVirtualization/applicationGroups/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "logs": [
                                                                {
                                                                    "category": "Checkpoint",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Error",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Management",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-WVDAppGroup"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Azure API for FHIR to stream to a Log Analytics workspace when any Azure API for FHIR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Azure API for FHIR to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.HealthcareApis/services"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.HealthcareApis/services/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "AuditLogs",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-ApiForFHIR"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Azure Data Explorer Cluster to stream to a Log Analytics workspace when any Azure Data Explorer Cluster which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Azure Data Explorer Cluster to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Kusto/Clusters"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Kusto/Clusters/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "SucceededIngestion",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "FailedIngestion",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "IngestionBatching",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Command",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "Query",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "TableUsageStatistics",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                },
                                                                {
                                                                    "category": "TableDetails",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-DataExplorerCluster"
                },
                {
                    "properties": {
                        "description": "Deploys the diagnostic settings for Azure Media Service to stream to a Log Analytics workspace when any Azure Media Service which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled",
                        "displayName": "Deploy Diagnostic Settings for Azure Media Service to Log Analytics workspace",
                        "mode": "Indexed",
                        "parameters": {
                            "logAnalytics": {
                                "type": "String",
                                "metadata": {
                                    "displayName": "Log Analytics workspace",
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "strongType": "omsWorkspace"
                                }
                            },
                            "effect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Effect",
                                    "description": "Enable or disable the execution of the policy"
                                }
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "metricsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable metrics",
                                    "description": "Whether to enable metrics stream to the Log Analytics workspace - True or False"
                                }
                            },
                            "logsEnabled": {
                                "type": "String",
                                "defaultValue": "True",
                                "allowedValues": [
                                    "True",
                                    "False"
                                ],
                                "metadata": {
                                    "displayName": "Enable logs",
                                    "description": "Whether to enable logs stream to the Log Analytics workspace - True or False"
                                }
                            }
                        },
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "policyRule": {
                            "if": {
                                "field": "type",
                                "equals": "Microsoft.Media/mediaServices"
                            },
                            "then": {
                                "effect": "[[parameters('effect')]",
                                "details": {
                                    "type": "Microsoft.Insights/diagnosticSettings",
                                    "name": "setByPolicy",
                                    "existenceCondition": {
                                        "allOf": [
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/logs.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/metrics.enabled",
                                                "equals": "true"
                                            },
                                            {
                                                "field": "Microsoft.Insights/diagnosticSettings/workspaceId",
                                                "equals": "[[parameters('logAnalytics')]"
                                            }
                                        ]
                                    },
                                    "roleDefinitionIds": [
                                        "/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa",
                                        "/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293"
                                    ],
                                    "deployment": {
                                        "properties": {
                                            "mode": "Incremental",
                                            "template": {
                                                "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                                                "contentVersion": "1.0.0.0",
                                                "parameters": {
                                                    "resourceName": {
                                                        "type": "String"
                                                    },
                                                    "logAnalytics": {
                                                        "type": "String"
                                                    },
                                                    "location": {
                                                        "type": "String"
                                                    },
                                                    "profileName": {
                                                        "type": "String"
                                                    },
                                                    "metricsEnabled": {
                                                        "type": "String"
                                                    },
                                                    "logsEnabled": {
                                                        "type": "String"
                                                    }
                                                },
                                                "variables": {},
                                                "resources": [
                                                    {
                                                        "type": "Microsoft.Media/mediaServices/providers/diagnosticSettings",
                                                        "apiVersion": "2017-05-01-preview",
                                                        "name": "[[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]",
                                                        "location": "[[parameters('location')]",
                                                        "dependsOn": [],
                                                        "properties": {
                                                            "workspaceId": "[[parameters('logAnalytics')]",
                                                            "metrics": [
                                                                {
                                                                    "category": "AllMetrics",
                                                                    "enabled": "[[parameters('metricsEnabled')]",
                                                                    "retentionPolicy": {
                                                                        "days": 0,
                                                                        "enabled": false
                                                                    },
                                                                    "timeGrain": null
                                                                }
                                                            ],
                                                            "logs": [
                                                                {
                                                                    "category": "KeyDeliveryRequests",
                                                                    "enabled": "[[parameters('logsEnabled')]"
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ],
                                                "outputs": {}
                                            },
                                            "parameters": {
                                                "logAnalytics": {
                                                    "value": "[[parameters('logAnalytics')]"
                                                },
                                                "location": {
                                                    "value": "[[field('location')]"
                                                },
                                                "resourceName": {
                                                    "value": "[[field('name')]"
                                                },
                                                "profileName": {
                                                    "value": "[[parameters('profileName')]"
                                                },
                                                "metricsEnabled": {
                                                    "value": "[[parameters('metricsEnabled')]"
                                                },
                                                "logsEnabled": {
                                                    "value": "[[parameters('logsEnabled')]"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "name": "Deploy-Diagnostics-MediaService"
                }
            ]
        },
        "initiatives": {
            "policySetDefinitions": [
                {
                    "properties": {
                        "description": "This policy set deploys the configurations of application Azure resources to forward diagnostic logs and metrics to an Azure Log Analytics workspace. See the list of policies of the services that are included ",
                        "displayName": "Deploy Diagnostic Settings to Azure Services",
                        "parameters": {
                            "logAnalytics": {
                                "metadata": {
                                    "description": "Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.",
                                    "displayName": "Log Analytics workspace",
                                    "strongType": "omsWorkspace"
                                },
                                "type": "String"
                            },
                            "profileName": {
                                "type": "String",
                                "defaultValue": "setByPolicy",
                                "metadata": {
                                    "displayName": "Profile name",
                                    "description": "The diagnostic settings profile name"
                                }
                            },
                            "ACILogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Container Instances to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Container Instances to stream to a Log Analytics workspace when any ACR which is missing this diagnostic settings is created or updated. The Policy willset the diagnostic with all metrics enabled."
                                }
                            },
                            "ACRLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Container Registry to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Container Registry to stream to a Log Analytics workspace when any ACR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics  enabled."
                                }
                            },
                            "AKSLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Kubernetes Service to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Kubernetes Service to stream to a Log Analytics workspace when any Kubernetes Service which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled."
                                }
                            },
                            "AnalysisServiceLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Analysis Services to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Analysis Services to stream to a Log Analytics workspace when any Analysis Services which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "APIforFHIRLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Azure API for FHIR to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Azure API for FHIR to stream to a Log Analytics workspace when any Azure API for FHIR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "APIMgmtLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for API Management to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for API Management to stream to a Log Analytics workspace when any API Management which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "ApplicationGatewayLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Application Gateway to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Application Gateway to stream to a Log Analytics workspace when any Application Gateway which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "AutomationLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Automation to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Automation to stream to a Log Analytics workspace when any Automation which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "BatchLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Batch to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Batch to stream to a Log Analytics workspace when any Batch which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "CDNEndpointsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for CDN Endpoint to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for CDN Endpoint to stream to a Log Analytics workspace when any CDN Endpoint which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "CognitiveServicesLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Cognitive Services to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Cognitive Services to stream to a Log Analytics workspace when any Cognitive Services which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "CosmosLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Cosmos DB to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Cosmos DB to stream to a Log Analytics workspace when any Cosmos DB which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "DatabricksLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Databricks to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Databricks to stream to a Log Analytics workspace when any Databricks which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "DataExplorerClusterLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Azure Data Explorer Cluster to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Azure Data Explorer Cluster to stream to a Log Analytics workspace when any Azure Data Explorer Cluster which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "DataFactoryLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Data Factory to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Data Factory to stream to a Log Analytics workspace when any Data Factory which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "DataLakeStoreLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Azure Data Lake Store to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Azure Data Lake Store to stream to a Log Analytics workspace when anyAzure Data Lake Store which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "DataLakeAnalyticsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Data Lake Analytics to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Data Lake Analytics to stream to a Log Analytics workspace when any Data Lake Analytics which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "EventGridSubLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Event Grid subscriptions to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Event Grid subscriptions to stream to a Log Analytics workspace when any Event Grid subscriptions which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "EventGridTopicLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Event Grid Topic to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Event Grid Topic to stream to a Log Analytics workspace when any Event Grid Topic which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "EventHubLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Event Hubs to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Event Hubs to stream to a Log Analytics workspace when any Event Hubs which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "EventSystemTopicLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Event Grid System Topic to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Event Grid System Topic to stream to a Log Analytics workspace when any Event Grid System Topic which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "ExpressRouteLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for ExpressRoute to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for ExpressRoute to stream to a Log Analytics workspace when any ExpressRoute which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "FirewallLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Firewall to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Firewall to stream to a Log Analytics workspace when any Firewall which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "FrontDoorLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Front Door to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Front Door to stream to a Log Analytics workspace when any Front Door which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "FunctionAppLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Azure Function App to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Azure Function App to stream to a Log Analytics workspace when any function app which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "HDInsightLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for HDInsight to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for HDInsight to stream to a Log Analytics workspace when any HDInsight which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "IotHubLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for IoT Hub to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for IoT Hub to stream to a Log Analytics workspace when any IoT Hub which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "KeyVaultLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Key Vault to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Key Vault to stream to a Log Analytics workspace when any Key Vault which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "LoadBalancerLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Load Balancer to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Load Balancer to stream to a Log Analytics workspace when any Load Balancer which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "LogicAppsISELogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Logic Apps integration service environment to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Logic Apps integration service environment to stream to a Log Analytics workspace when any Logic Apps integration service environment which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "LogicAppsWFLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Logic Apps Workflows to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Logic Apps Workflows to stream to a Log Analytics workspace when any Logic Apps Workflows which are missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "MariaDBLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for MariaDB to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for MariaDB to stream to a Log Analytics workspace when any MariaDB  which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "MediaServiceLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Azure Media Service to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Azure Media Service to stream to a Log Analytics workspace when any Azure Media Service which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "MlWorkspaceLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Machine Learning workspace to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Machine Learning workspace to stream to a Log Analytics workspace when any Machine Learning workspace which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "MySQLLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Database for MySQL to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Database for MySQL to stream to a Log Analytics workspace when any Database for MySQL which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "NetworkSecurityGroupsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Network Security Groups to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Network Security Groups to stream to a Log Analytics workspace when any Network Security Groups which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "NetworkNICLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Network Interfaces to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Network Interfaces to stream to a Log Analytics workspace when any Network Interfaces which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "PostgreSQLLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Database for PostgreSQL to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Database for PostgreSQL to stream to a Log Analytics workspace when any Database for PostgreSQL which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "PowerBIEmbeddedLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Power BI Embedded to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Power BI Embedded to stream to a Log Analytics workspace when any Power BI Embedded which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "NetworkPublicIPNicLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Public IP addresses to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Public IP addresses to stream to a Log Analytics workspace when any Public IP addresses which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "RedisCacheLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Redis Cache to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Redis Cache to stream to a Log Analytics workspace when any Redis Cache which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "RelayLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Relay to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Relay to stream to a Log Analytics workspace when any Relay which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "SearchServicesLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Search Services to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Search Services to stream to a Log Analytics workspace when any Search Services which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "ServiceBusLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Service Bus namespaces  to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for ServiceBus to stream to a Log Analytics workspace when any ServiceBus which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "SignalRLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for SignalR to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for SignalR to stream to a Log Analytics workspace when any SignalR which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "SQLDBsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for SQL Databases  to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for SQL Databases to stream to a Log Analytics workspace when any SQL Databases  which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "SQLElasticPoolsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for SQL Elastic Pools to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for SQL Elastic Pools to stream to a Log Analytics workspace when any SQL Elastic Pools which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "SQLMLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for SQL Managed Instances to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for SQL Managed Instances to stream to a Log Analytics workspace when any SQL Managed Instances which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "StreamAnalyticsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Stream Analytics to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Stream Analytics to stream to a Log Analytics workspace when any Stream Analytics which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "TimeSeriesInsightsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Time Series Insights to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Time Series Insights to stream to a Log Analytics workspace when any Time Series Insights which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "TrafficManagerLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Traffic Manager to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Traffic Manager to stream to a Log Analytics workspace when any Traffic Manager which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "VirtualNetworkLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Virtual Network to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Virtual Network to stream to a Log Analytics workspace when any Virtual Network which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "VirtualMachinesLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Virtual Machines to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Virtual Machines to stream to a Log Analytics workspace when any Virtual Machines which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "VMSSLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Virtual Machine Scale Sets to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Virtual Machine Scale Sets  to stream to a Log Analytics workspace when any Virtual Machine Scale Sets  which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "VNetGWLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for VPN Gateway to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for VPN Gateway to stream to a Log Analytics workspace when any VPN Gateway which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled."
                                }
                            },
                            "AppServiceLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for App Service Plan to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for App Service Plan to stream to a Log Analytics workspace when any App Service Plan which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "AppServiceWebappLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for App Service to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Web App to stream to a Log Analytics workspace when any Web App which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "WVDAppGroupsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for WVD Application Groups to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for WVD Application groups to stream to a Log Analytics workspace when any application groups which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "WVDWorkspaceLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for WVD Workspace to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for WVD Workspace to stream to a Log Analytics workspace when any Workspace which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "WVDHostPoolsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for WVD Host pools to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for WVD Host pools to stream to a Log Analytics workspace when any host pool which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            },
                            "StorageAccountsLogAnalyticsEffect": {
                                "type": "String",
                                "defaultValue": "DeployIfNotExists",
                                "allowedValues": [
                                    "DeployIfNotExists",
                                    "Disabled"
                                ],
                                "metadata": {
                                    "displayName": "Deploy Diagnostic Settings for Storage Accounts to Log Analytics workspace",
                                    "description": "Deploys the diagnostic settings for Storage Accounts to stream to a Log Analytics workspace when any storage account which is missing this diagnostic settings is created or updated. The Policy will set the diagnostic with all metrics and category enabled"
                                }
                            }
                        },
                        "policyDefinitionGroups": null,
                        "metadata": {
                            "version": "1.0.0",
                            "category": "Monitoring"
                        },
                        "PolicyDefinitions": [
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6f8f98a4-f108-47cb-8e98-91a0d85cd474",
                                "policyDefinitionReferenceId": "StorageAccountDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('StorageAccountsLogAnalyticsEffect')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-WVDAppGroup')]",
                                "policyDefinitionReferenceId": "WVDAppGroupDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('WVDAppGroupsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-WVDWorkspace')]",
                                "policyDefinitionReferenceId": "WVDWorkspaceDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('WVDWorkspaceLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-WVDHostPools')]",
                                "policyDefinitionReferenceId": "WVDHostPoolsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('WVDHostPoolsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-ACI')]",
                                "policyDefinitionReferenceId": "ACIDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('ACILogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-ACR')]",
                                "policyDefinitionReferenceId": "ACRDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('ACRLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/6c66c325-74c8-42fd-a286-a74b0e2939d8",
                                "policyDefinitionReferenceId": "AKSDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('AKSLogAnalyticsEffect')]"
                                    },
                                    "diagnosticsSettingNameToUse": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-AnalysisService')]",
                                "policyDefinitionReferenceId": "AnalysisServiceDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('AnalysisServiceLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-ApiForFHIR')]",
                                "policyDefinitionReferenceId": "APIforFHIRDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('APIforFHIRLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-APIMgmt')]",
                                "policyDefinitionReferenceId": "APIMgmtDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('APIMgmtLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-ApplicationGateway')]",
                                "policyDefinitionReferenceId": "ApplicationGatewayDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('ApplicationGatewayLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-AA')]",
                                "policyDefinitionReferenceId": "AutomationDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('AutomationLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c84e5349-db6d-4769-805e-e14037dab9b5",
                                "policyDefinitionReferenceId": "BatchDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('BatchLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-CDNEndpoints')]",
                                "policyDefinitionReferenceId": "CDNEndpointsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('CDNEndpointsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-CognitiveServices')]",
                                "policyDefinitionReferenceId": "CognitiveServicesDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('CognitiveServicesLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-CosmosDB')]",
                                "policyDefinitionReferenceId": "CosmosDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('CosmosLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-Databricks')]",
                                "policyDefinitionReferenceId": "DatabricksDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('DatabricksLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-DataExplorerCluster')]",
                                "policyDefinitionReferenceId": "DataExplorerClusterDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('DataExplorerClusterLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-DataFactory')]",
                                "policyDefinitionReferenceId": "DataFactoryDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('DataFactoryLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/d56a5a7c-72d7-42bc-8ceb-3baf4c0eae03",
                                "policyDefinitionReferenceId": "DataLakeStoreDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('DataLakeStoreLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-DLAnalytics')]",
                                "policyDefinitionReferenceId": "DataLakeAnalyticsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('DataLakeAnalyticsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-EventGridSub')]",
                                "policyDefinitionReferenceId": "EventGridSubDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('EventGridSubLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-EventGridTopic')]",
                                "policyDefinitionReferenceId": "EventGridTopicDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('EventGridTopicLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1f6e93e8-6b31-41b1-83f6-36e449a42579",
                                "policyDefinitionReferenceId": "EventHubDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('EventHubLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-EventGridSystemTopic')]",
                                "policyDefinitionReferenceId": "EventSystemTopicDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('EventSystemTopicLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-ExpressRoute')]",
                                "policyDefinitionReferenceId": "ExpressRouteDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('ExpressRouteLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-Firewall')]",
                                "policyDefinitionReferenceId": "FirewallDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('FirewallLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-FrontDoor')]",
                                "policyDefinitionReferenceId": "FrontDoorDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('FrontDoorLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-Function')]",
                                "policyDefinitionReferenceId": "FunctionAppDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('FunctionAppLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-HDInsight')]",
                                "policyDefinitionReferenceId": "HDInsightDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('HDInsightLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-iotHub')]",
                                "policyDefinitionReferenceId": "IotHubDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('IotHubLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/bef3f64c-5290-43b7-85b0-9b254eef4c47",
                                "policyDefinitionReferenceId": "KeyVaultDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('KeyVaultLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-LoadBalancer')]",
                                "policyDefinitionReferenceId": "LoadBalancerDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('LoadBalancerLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-LogicAppsISE')]",
                                "policyDefinitionReferenceId": "LogicAppsISEDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('LogicAppsISELogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b889a06c-ec72-4b03-910a-cb169ee18721",
                                "policyDefinitionReferenceId": "LogicAppsWFDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('LogicAppsWFLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-MariaDB')]",
                                "policyDefinitionReferenceId": "MariaDBDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('MariaDBLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-MediaService')]",
                                "policyDefinitionReferenceId": "MediaServiceDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('MediaServiceLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-MlWorkspace')]",
                                "policyDefinitionReferenceId": "MlWorkspaceDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('MlWorkspaceLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-MySQL')]",
                                "policyDefinitionReferenceId": "MySQLDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('MySQLLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-NetworkSecurityGroups')]",
                                "policyDefinitionReferenceId": "NetworkSecurityGroupsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('NetworkSecurityGroupsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-NIC')]",
                                "policyDefinitionReferenceId": "NetworkNICDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('NetworkNICLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-PostgreSQL')]",
                                "policyDefinitionReferenceId": "PostgreSQLDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('PostgreSQLLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-PowerBIEmbedded')]",
                                "policyDefinitionReferenceId": "PowerBIEmbeddedDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('PowerBIEmbeddedLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/752154a7-1e0f-45c6-a880-ac75a7e4f648",
                                "policyDefinitionReferenceId": "NetworkPublicIPNicDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('NetworkPublicIPNicLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    },
                                    "metricsEnabled": {
                                        "value": "True"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c717fb0c-d118-4c43-ab3d-ece30ac81fb3",
                                "policyDefinitionReferenceId": "RecoveryVaultDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-RedisCache')]",
                                "policyDefinitionReferenceId": "RedisCacheDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('RedisCacheLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-Relay')]",
                                "policyDefinitionReferenceId": "RelayDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('RelayLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/08ba64b8-738f-4918-9686-730d2ed79c7d",
                                "policyDefinitionReferenceId": "SearchServicesDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('SearchServicesLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/04d53d87-841c-4f23-8a5b-21564380b55e",
                                "policyDefinitionReferenceId": "ServiceBusDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('ServiceBusLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-SignalR')]",
                                "policyDefinitionReferenceId": "SignalRDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('SignalRLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b79fa14e-238a-4c2d-b376-442ce508fc84",
                                "policyDefinitionReferenceId": "SQLDatabaseDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('SQLDBsLogAnalyticsEffect')]"
                                    },
                                    "diagnosticsSettingNameToUse": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-SQLElasticPools')]",
                                "policyDefinitionReferenceId": "SQLElasticPoolsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('SQLElasticPoolsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-SQLMI')]",
                                "policyDefinitionReferenceId": "SQLMDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('SQLMLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/237e0f7e-b0e8-4ec4-ad46-8c12cb66d673",
                                "policyDefinitionReferenceId": "StreamAnalyticsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('StreamAnalyticsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-TimeSeriesInsights')]",
                                "policyDefinitionReferenceId": "TimeSeriesInsightsDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('TimeSeriesInsightsLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-TrafficManager')]",
                                "policyDefinitionReferenceId": "TrafficManagerDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('TrafficManagerLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-VirtualNetwork')]",
                                "policyDefinitionReferenceId": "VirtualNetworkDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('VirtualNetworkLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-VM')]",
                                "policyDefinitionReferenceId": "VirtualMachinesDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('VirtualMachinesLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-VMSS')]",
                                "policyDefinitionReferenceId": "VMSSDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('VMSSLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-VNetGW')]",
                                "policyDefinitionReferenceId": "VNetGWDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('VNetGWLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-WebServerFarm')]",
                                "policyDefinitionReferenceId": "AppServiceDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('AppServiceLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            },
                            {
                                "policyDefinitionId": "[concat(variables('scope'), '/providers/Microsoft.Authorization/policyDefinitions/Deploy-Diagnostics-Website')]",
                                "policyDefinitionReferenceId": "AppServiceWebappDeployDiagnosticLogDeployLogAnalytics",
                                "parameters": {
                                    "logAnalytics": {
                                        "value": "[[parameters('logAnalytics')]"
                                    },
                                    "effect": {
                                        "value": "[[parameters('AppServiceWebappLogAnalyticsEffect')]"
                                    },
                                    "profileName": {
                                        "value": "[[parameters('profileName')]"
                                    }
                                }
                            }
                        ]
                    },
                    "name": "Deploy-Diagnostics-LogAnalytics"
                }
            ]
        }
    },
    "resources": [
        {
            "type": "Microsoft.Authorization/policyDefinitions",
            "name": "[variables('policies').policyDefinitions[copyIndex()].name]",
            "apiVersion": "2019-09-01",
            "copy": {
                "name": "policyDefinitionCopy",
                "count": "[length(variables('policies').policyDefinitions)]"
            },
            "properties": {
                "displayName": "[variables('policies').policyDefinitions[copyIndex()].properties.displayName]",
                "description": "[variables('policies').policyDefinitions[copyIndex()].properties.description]",
                "mode": "[variables('policies').policyDefinitions[copyIndex()].properties.mode]",
                "policyType": "Custom",
                "parameters": "[variables('policies').policyDefinitions[copyIndex()].properties.parameters]",
                "policyRule": "[variables('policies').policyDefinitions[copyIndex()].properties.policyRule]",
                "metadata": "[variables('policies').policyDefinitions[copyIndex()].properties.metadata]"
            }
        },
        {
            "type": "Microsoft.Authorization/policySetDefinitions",
            "name": "[variables('initiatives').policySetDefinitions[copyIndex()].name]",
            "apiVersion": "2021-09-01",
            "dependsOn": [
                "policyDefinitionCopy"
            ],
            "copy": {
                "name": "policySetDefinitionCopy",
                "count": "[length(variables('initiatives').policySetDefinitions)]"
            },
            "properties": {
                "displayName": "[variables('initiatives').policySetDefinitions[copyIndex()].properties.displayName]",
                "description": "[variables('initiatives').policySetDefinitions[copyIndex()].properties.description]",
                "parameters": "[variables('initiatives').policySetDefinitions[copyIndex()].properties.parameters]",
                "policyDefinitions": "[variables('initiatives').policySetDefinitions[copyIndex()].properties.policyDefinitions]",
                "metadata": "[variables('initiatives').policySetDefinitions[copyIndex()].properties.metadata]"
            }
        }
    ]
}